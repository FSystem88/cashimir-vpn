<!-- popup.html -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>CASHIMIR VPN</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div class="brand">
        <img src="icons/icon32.png" alt="CASHIMIR" class="brand-icon">
        <span class="brand-name">CASHIMIR VPN</span>
      </div>
      <label class="switch" title="Тема">
        <input id="themeToggleSwitchTop" type="checkbox">
        <span class="slider"></span>
      </label>
    </div>
    <div id="proxyForm" class="hidden">
      <h2>Настройки VPN</h2>
      <p>Статус: <span id="initialIP">Загрузка...</span></p>
      
      <h3>Поиск бесплатного прокси:</h3>
      <button id="findProxyBtn" class="bypass-btn">Найти прокси</button>
      <button id="stopFindProxyBtn" class="bypass-btn hidden">Остановить поиск</button>
      <p>Проверено прокси: <span id="proxyTestCount">0</span></p>
      <h3>Ввести свой прокси:</h3>
      <form id="form">
        <label for="proxyIP">IP-адрес:</label>
        <input type="text" id="proxyIP" name="proxyIP" required placeholder="192.168.0.1">
        <label for="proxyPort">Порт:</label>
        <input type="number" id="proxyPort" name="proxyPort" required placeholder="1080">
        <label for="proxyType">Тип прокси:</label>
        <select id="proxyType" name="proxyType" required>
          <option value="socks5">SOCKS5</option>
          <option value="socks4">SOCKS4</option>
          <option value="http">HTTP</option>
          <option value="https">HTTPS</option>
        </select>
        <label for="proxyLogin">Логин:</label>
        <input type="text" id="proxyLogin" name="proxyLogin" placeholder="Логин (необязательно)">
        <label for="proxyPassword">Пароль:</label>
        <input type="password" id="proxyPassword" name="proxyPassword" placeholder="Пароль (необязательно)">
        <label for="bypassList">Список исключений:</label>
        <textarea id="bypassList" name="bypassList" placeholder="*.ru, example.com"></textarea>
        <label for="proxyOnlyList">Список проксируемых сайтов:</label>
        <textarea id="proxyOnlyList" name="proxyOnlyList" placeholder="example.org, *.com"></textarea>
        <div class="form-buttons">
          <button type="button" id="testBtn" disabled>Протестировать</button>
          <button type="submit" id="connectBtn" class="hidden">Подключиться</button>
        </div>
      </form>
      <div class="card">
        <h3>Профили</h3>
        <div class="profiles">
          <input type="text" id="profileName" placeholder="Название профиля">
          <button id="saveProfileBtn">Сохранить профиль</button>
        </div>
        <ul id="profilesList" class="list"></ul>
      </div>
      <div id="testResult" class="test-result"></div>
      <div id="formError" class="error"></div>
      <div class="settings">
        <button id="importBtn">Импорт</button>
        <button id="exportBtn">Экспорт</button>
        <input type="file" id="importFile" accept=".json" class="hidden">
      </div>
      <div id="history" class="history hidden">
        <h3>История подключений</h3>
        <ul id="historyList"></ul>
        <button id="clearHistoryBtn" class="bypass-btn">Очистить историю</button>
      </div>
    </div>
    <div id="proxyControl" class="hidden">
      <button id="toggleBtn" class="hidden">Загрузка...</button>
      
      <div id="logs">
        <p>Статус: <span id="currentIP">Загрузка...</span></p>
        <p id="proxyTestCountControlRow">Проверено прокси: <span id="proxyTestCountControl">0</span></p>
        <div class="latency">
          <span>Пинг: <strong id="latencyValue">—</strong></span>
          <button id="latencyBtn" class="bypass-btn">Измерить</button>
        </div>
      </div>
      <div class="bypass-controls">
        <button id="addBypassBtn" class="bypass-btn">Добавить сайт в исключения</button>
        <button id="addProxyOnlyBtn" class="bypass-btn">Добавить сайт в прокси</button>
        <button id="removeBypassBtn" class="bypass-btn hidden">Удалить из исключений</button>
        <button id="removeProxyOnlyBtn" class="bypass-btn hidden">Удалить из прокси</button>
      </div>
      <div id="bypassListDisplay" class="bypass-list">
        <h3>Текущие исключения</h3>
        <textarea id="bypassListControl" name="bypassListControl" placeholder="*.ru, example.com"></textarea>
        <div class="btn-row">
          <button id="saveBypassBtn" class="bypass-btn">Сохранить</button>
          <button id="clearBypassBtn" class="bypass-btn">Очистить</button>
        </div>
        <ul id="bypassSites"></ul>
      </div>
      <div id="proxyOnlyListDisplay" class="bypass-list">
        <h3>Проксируемые сайты</h3>
        <textarea id="proxyOnlyListControl" name="proxyOnlyListControl" placeholder="example.org, *.com"></textarea>
        <div class="btn-row">
          <button id="saveProxyOnlyBtn" class="bypass-btn">Сохранить</button>
          <button id="clearProxyOnlyBtn" class="bypass-btn">Очистить</button>
        </div>
        <ul id="proxyOnlySites"></ul>
      </div>
      <button id="logoutBtn" class="hidden">Выйти</button>
    </div>
  </div>
  <script src="popup.js"></script>
</body>
</html>